<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>打砖块 - Breakout</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:'Noto Sans SC',sans-serif;
  background:linear-gradient(135deg,#e3f2fd,#ffffff);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.back-link{
  position:fixed;
  top:1rem;
  left:1rem;
  text-decoration:none;
  color:#666;
  font-weight:bold;
}
.back-link:hover{color:#ff8f00;}

.game-box{
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  text-align:center;
}

.score{
  margin-bottom:10px;
  font-weight:bold;
}

canvas{
  background:#f5f5f5;
  border-radius:12px;
}

.overlay{
  position:absolute;
  top:0;left:0;
  width:100%;height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  background:rgba(255,255,255,0.9);
  border-radius:20px;
}

.hidden{display:none;}

button{
  margin-top:10px;
  padding:8px 16px;
  border:none;
  border-radius:8px;
  background:linear-gradient(135deg,#ff8f00,#ffeb3b);
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>

<a href="index.html" class="back-link">← 返回游戏列表</a>

<div class="game-box">
  <div class="score">
    分数: <span id="score">0</span> |
    最高分: <span id="best">0</span> |
    生命: <span id="lives">3</span>
  </div>

  <div style="position:relative">
    <canvas id="game" width="500" height="400"></canvas>
    <div id="overlay" class="overlay">
      <h2 id="overlayText">点击开始游戏</h2>
      <button onclick="startGame()">开始游戏</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let ball, paddle, bricks;
let score = 0;
let best = localStorage.getItem("breakoutBest") || 0;
let lives = 3;
let gameRunning = false;

document.getElementById("best").textContent = best;

function reset(){
  ball = { x:250, y:300, dx:4, dy:-4, r:8 };
  paddle = { x:200, y:360, w:100, h:12 };
  score = 0;
  lives = 3;
  document.getElementById("score").textContent = 0;
  document.getElementById("lives").textContent = lives;

  bricks = [];
  for(let r=0;r<5;r++){
    for(let c=0;c<8;c++){
      bricks.push({
        x: c*55+30,
        y: r*25+40,
        w:50,
        h:15,
        broken:false
      });
    }
  }
}

function startGame(){
  document.getElementById("overlay").classList.add("hidden");
  reset();
  gameRunning = true;
  loop();
}

function drawBall(){
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
  ctx.fillStyle="#ff7043";
  ctx.fill();
}

function drawPaddle(){
  ctx.fillStyle="#43a047";
  ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
}

function drawBricks(){
  bricks.forEach(b=>{
    if(!b.broken){
      ctx.fillStyle="#2196f3";
      ctx.fillRect(b.x,b.y,b.w,b.h);
    }
  });
}

function update(){
  ball.x+=ball.dx;
  ball.y+=ball.dy;

  // 墙壁
  if(ball.x<ball.r || ball.x>canvas.width-ball.r) ball.dx*=-1;
  if(ball.y<ball.r) ball.dy*=-1;

  // 掉下去
  if(ball.y>canvas.height){
    lives--;
    document.getElementById("lives").textContent=lives;
    if(lives<=0){
      gameOver();
      return;
    }
    ball.x=250; ball.y=300; ball.dy=-4;
  }

  // 挡板
  if(
    ball.x>paddle.x &&
    ball.x<paddle.x+paddle.w &&
    ball.y+ball.r>paddle.y
  ){
    ball.dy=-Math.abs(ball.dy);
  }

  // 砖块
  bricks.forEach(b=>{
    if(!b.broken &&
      ball.x>b.x &&
      ball.x<b.x+b.w &&
      ball.y>b.y &&
      ball.y<b.y+b.h
    ){
      b.broken=true;
      ball.dy*=-1;
      score+=10;
      document.getElementById("score").textContent=score;
    }
  });

  // 胜利
  if(bricks.every(b=>b.broken)){
    gameOver(true);
  }
}

function gameOver(win=false){
  gameRunning=false;

  if(score>best){
    best=score;
    localStorage.setItem("breakoutBest",best);
    document.getElementById("best").textContent=best;
  }

  document.getElementById("overlayText").textContent=
    win?"恭喜通关！":"游戏结束";
  document.getElementById("overlay").classList.remove("hidden");
}

function loop(){
  if(!gameRunning) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBall();
  drawPaddle();
  drawBricks();
  update();
  requestAnimationFrame(loop);
}

canvas.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  const mouseX=e.clientX-rect.left;
  paddle.x=mouseX-paddle.w/2;
});
</script>

</body>
</html>