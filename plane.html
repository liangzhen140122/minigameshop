<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>飞机大战 · 豪华版</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
  font-family:sans-serif;
}
.game-box{text-align:center;position:relative;}
canvas{background:black;border-radius:15px;}
.overlay{
  position:absolute;top:0;left:0;
  width:100%;height:100%;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:rgba(0,0,0,0.85);
  border-radius:15px;
}
button{
  padding:8px 16px;
  border:none;border-radius:8px;
  cursor:pointer;font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="game-box">
  <h2>✈️ 飞机大战 · 豪华版</h2>
  <p>分数: <span id="score">0</span> |
     最高分: <span id="best">0</span> |
     生命: <span id="lives">3</span></p>

  <div style="position:relative">
    <canvas id="game" width="400" height="600"></canvas>
    <div id="overlay" class="overlay">
      <h2 id="msg">点击开始</h2>
      <button onclick="startGame()">开始游戏</button>
    </div>
  </div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let player,bullets,enemies,explosions,stars;
let score=0,lives=3,level=1;
let gameRunning=false;
let best=localStorage.getItem("planeBest")||0;
document.getElementById("best").textContent=best;

function reset(){
  player={x:180,y:520,w:40,h:40};
  bullets=[];enemies=[];explosions=[];
  stars=[];
  for(let i=0;i<100;i++){
    stars.push({x:Math.random()*400,y:Math.random()*600,s:Math.random()*2});
  }
  score=0;lives=3;level=1;
  updateUI();
}

function updateUI(){
  document.getElementById("score").textContent=score;
  document.getElementById("lives").textContent=lives;
}

function startGame(){
  document.getElementById("overlay").style.display="none";
  reset();
  gameRunning=true;
  loop();
}

function drawStars(){
  ctx.fillStyle="white";
  stars.forEach(s=>{
    ctx.fillRect(s.x,s.y,s.s,s.s);
    s.y+=1;
    if(s.y>600)s.y=0;
  });
}

function drawPlayer(){
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function drawBullets(){
  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));
}

function drawEnemies(){
  enemies.forEach(e=>{
    ctx.fillStyle=e.type==="boss"?"purple":(e.type==="elite"?"orange":"red");
    ctx.fillRect(e.x,e.y,e.w,e.h);
  });
}

function drawExplosions(){
  explosions.forEach(ex=>{
    ctx.fillStyle="rgba(255,165,0,"+ex.life/20+")";
    ctx.beginPath();
    ctx.arc(ex.x,ex.y,20-ex.life,0,Math.PI*2);
    ctx.fill();
    ex.life--;
  });
  explosions=explosions.filter(e=>e.life>0);
}

function update(){
  bullets.forEach(b=>b.y-=8);
  enemies.forEach(e=>e.y+=e.speed);

  bullets=bullets.filter(b=>b.y>0);
  enemies=enemies.filter(e=>e.y<620);

  // 自动发射
  if(Math.random()<0.3){
    bullets.push({x:player.x+18,y:player.y});
  }

  // 生成敌人
  if(Math.random()<0.02+level*0.002){
    let type="normal";
    if(score>500 && Math.random()<0.2) type="elite";
    if(score>1500 && Math.random()<0.05) type="boss";

    let w=30,h=30,life=1,speed=2;
    if(type==="elite"){w=35;h=35;life=3;speed=3;}
    if(type==="boss"){w=60;h=60;life=20;speed=1;}

    enemies.push({
      x:Math.random()*(400-w),
      y:0,w,h,life,type,speed
    });
  }

  // 碰撞
  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(b.x<e.x+e.w && b.x+4>e.x &&
         b.y<e.y+e.h && b.y+10>e.y){
        e.life--;
        bullets.splice(bi,1);
        if(e.life<=0){
          score+=e.type==="boss"?500:(e.type==="elite"?50:10);
          explosions.push({x:e.x+e.w/2,y:e.y+e.h/2,life:20});
          enemies.splice(ei,1);
        }
      }
    });
  });

  enemies.forEach((e,ei)=>{
    if(e.x<player.x+player.w &&
       e.x+e.w>player.x &&
       e.y<player.y+player.h &&
       e.y+e.h>player.y){
      enemies.splice(ei,1);
      explosions.push({x:player.x+20,y:player.y+20,life:20});
      lives--;
      if(lives<=0) gameOver();
    }
  });

  level=1+Math.floor(score/1000);
  updateUI();
}

function gameOver(){
  gameRunning=false;
  if(score>best){
    best=score;
    localStorage.setItem("planeBest",best);
    document.getElementById("best").textContent=best;
  }
  document.getElementById("msg").textContent="游戏结束";
  document.getElementById("overlay").style.display="flex";
}

function loop(){
  if(!gameRunning)return;
  ctx.clearRect(0,0,400,600);
  drawStars();
  drawPlayer();
  drawBullets();
  drawEnemies();
  drawExplosions();
  update();
  requestAnimationFrame(loop);
}

canvas.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  player.x=e.clientX-rect.left-player.w/2;
});
</script>

</body>
</html>