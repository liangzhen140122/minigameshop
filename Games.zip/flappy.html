<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Noto Sans SC',sans-serif;
  background:linear-gradient(135deg,#e3f2fd,#ffffff);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.back-link{
  position:fixed;
  top:1rem;
  left:1rem;
  text-decoration:none;
  color:#666;
  font-weight:bold;
}
.back-link:hover{color:#ff8f00;}

.game-box{
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  text-align:center;
}

canvas{
  background:linear-gradient(#81d4fa,#e1f5fe);
  border-radius:12px;
}

.score{
  margin-bottom:10px;
  font-weight:bold;
}

.overlay{
  position:absolute;
  top:0;left:0;
  width:100%;height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  background:rgba(255,255,255,0.9);
  border-radius:20px;
}

.hidden{display:none;}

button{
  margin-top:10px;
  padding:8px 16px;
  border:none;
  border-radius:8px;
  background:linear-gradient(135deg,#ff8f00,#ffeb3b);
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>

<a href="index.html" class="back-link">← 返回</a>

<div class="game-box">
  <div class="score">
    分数: <span id="score">0</span> |
    最高分: <span id="best">0</span>
  </div>
  <div style="position:relative">
    <canvas id="game" width="400" height="500"></canvas>
    <div id="overlay" class="overlay">
      <h2 id="overlayText">点击开始</h2>
      <button onclick="startGame()">开始游戏</button>
    </div>
  </div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let bird,pipes,score,best;
let gravity=0.45;
let lift=-8;
let speed;
let baseSpeed=1.8;
let gameRunning=false;

best=localStorage.getItem("flappyBest")||0;
document.getElementById("best").textContent=best;

function reset(){
  bird={
    x:80,
    y:200,
    vy:0,
    size:20,
    rotation:0
  };
  pipes=[];
  score=0;
  speed=baseSpeed;
  document.getElementById("score").textContent=0;
}

function startGame(){
  document.getElementById("overlay").classList.add("hidden");
  reset();
  gameRunning=true;
  loop();
}

function spawnPipe(){
  let dynamicGap=180 - Math.min(score*2,60); 
  let top=Math.random()*250+50;

  pipes.push({
    x:400,
    top:top,
    bottom:top+dynamicGap,
    passed:false
  });
}

function drawBird(){
  ctx.save();
  ctx.translate(bird.x,bird.y);
  ctx.rotate(bird.rotation);
  ctx.fillStyle="#ff7043";
  ctx.beginPath();
  ctx.arc(0,0,bird.size,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function drawPipes(){
  ctx.fillStyle="#43a047";
  pipes.forEach(p=>{
    ctx.fillRect(p.x,0,60,p.top);
    ctx.fillRect(p.x,p.bottom,60,500-p.bottom);
  });
}

function update(){
  bird.vy+=gravity;
  bird.y+=bird.vy;

  bird.rotation=Math.min(Math.max(bird.vy*0.05,-0.5),1);

  if(bird.y+bird.size>500||bird.y-bird.size<0){
    gameOver();
  }

  pipes.forEach(p=>{
    p.x-=speed;

    if(!p.passed && p.x+60<bird.x){
      p.passed=true;
      score++;
      document.getElementById("score").textContent=score;

      // 渐进难度
      if(score>10) speed=2;
      if(score>20) speed=2.3;
      if(score>30) speed=2.6;
    }

    if(
      bird.x+bird.size>p.x &&
      bird.x-bird.size<p.x+60 &&
      (bird.y-bird.size<p.top || bird.y+bird.size>p.bottom)
    ){
      gameOver();
    }
  });

  pipes=pipes.filter(p=>p.x>-60);

  if(pipes.length===0 || pipes[pipes.length-1].x<220){
    spawnPipe();
  }
}

function gameOver(){
  gameRunning=false;

  if(score>best){
    best=score;
    localStorage.setItem("flappyBest",best);
    document.getElementById("best").textContent=best;
  }

  document.getElementById("overlayText").textContent="游戏结束";
  document.getElementById("overlay").classList.remove("hidden");
}

function loop(){
  if(!gameRunning) return;
  ctx.clearRect(0,0,400,500);
  drawBird();
  drawPipes();
  update();
  requestAnimationFrame(loop);
}

function flap(){
  if(!gameRunning) return;
  bird.vy=lift;
}

canvas.addEventListener("mousedown",flap);
canvas.addEventListener("touchstart",e=>{
  e.preventDefault();
  flap();
});

document.addEventListener("keydown",e=>{
  if(e.code==="Space") flap();
});
</script>

</body>
</html>