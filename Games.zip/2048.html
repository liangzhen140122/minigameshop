<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 - Poki Pro</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family: Arial, sans-serif;
  background:#faf8ef;
  display:flex;
  justify-content:center;
  padding:40px;
}

/* 返回按钮 */
.back-link{
  position:fixed;
  top:20px;
  left:20px;
  background:#8f7a66;
  color:white;
  padding:8px 14px;
  border-radius:6px;
  text-decoration:none;
  font-size:14px;
}

.back-link:hover{
  opacity:0.9;
}

.container{
  width:1000px;
  display:flex;
  justify-content:space-between;
}

.left{ width:40%; }

h1{
  font-size:80px;
  color:#776e65;
}

.scores{
  display:flex;
  gap:15px;
  margin:20px 0;
}

.score-box{
  background:#bbada0;
  color:white;
  padding:10px 20px;
  border-radius:6px;
  text-align:center;
  min-width:100px;
}

.score-box span{
  display:block;
  font-size:22px;
  font-weight:bold;
}

button{
  background:#8f7a66;
  color:white;
  border:none;
  padding:12px 20px;
  border-radius:6px;
  cursor:pointer;
  margin-bottom:20px;
}

.board{
  position:relative;
  width:500px;
  height:500px;
  background:#bbada0;
  border-radius:10px;
}

.grid{
  position:absolute;
  width:100%;
  height:100%;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:15px;
  padding:15px;
}

.grid div{
  background:#cdc1b4;
  border-radius:6px;
}

.tiles{
  position:absolute;
  width:100%;
  height:100%;
  top:0;
  left:0;
}

.tile{
  position:absolute;
  width:110px;
  height:110px;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  font-weight:bold;
  transition:transform 0.18s ease;
}

.tile.new{
  animation:pop 0.2s ease;
}

@keyframes pop{
  0%{transform:scale(0);}
  100%{transform:scale(1);}
}

.tile-2{background:#eee4da;}
.tile-4{background:#ede0c8;}
.tile-8{background:#f2b179;color:white;}
.tile-16{background:#f59563;color:white;}
.tile-32{background:#f67c5f;color:white;}
.tile-64{background:#f65e3b;color:white;}
.tile-128{background:#edcf72;color:white;}
.tile-256{background:#edcc61;color:white;}
.tile-512{background:#edc850;color:white;}
.tile-1024{background:#edc53f;color:white;}
.tile-2048{background:#edc22e;color:white;}
</style>
</head>

<body>

<a href="index.html" class="back-link">← 返回游戏列表</a>

<div class="container">

<div class="left">
  <h1>2048</h1>

  <div class="scores">
    <div class="score-box">
      SCORE
      <span id="score">0</span>
    </div>
    <div class="score-box">
      BEST
      <span id="best">0</span>
    </div>
  </div>

  <button onclick="init()">New Game</button>
  <p>Use arrow keys to move tiles. Same numbers merge.</p>
</div>

<div class="right">
  <div class="board">
    <div class="grid">
      <div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div>
    </div>
    <div class="tiles"></div>
  </div>
</div>

</div>

<script>
const size=4;
const gap=15;
const cell=110;
const offset=15;

const tilesLayer=document.querySelector(".tiles");
const scoreEl=document.getElementById("score");
const bestEl=document.getElementById("best");

let board,score;

function init(){
  board=Array(size).fill().map(()=>Array(size).fill(0));
  score=0;
  scoreEl.textContent=0;
  tilesLayer.innerHTML="";
  addRandom(); addRandom();
}

function addRandom(){
  let empty=[];
  for(let r=0;r<size;r++)
    for(let c=0;c<size;c++)
      if(!board[r][c]) empty.push({r,c});

  if(!empty.length) return;

  const {r,c}=empty[Math.floor(Math.random()*empty.length)];
  board[r][c]=Math.random()<0.9?2:4;
  createTile(r,c,board[r][c],true);
}

function createTile(r,c,value,isNew=false){
  const tile=document.createElement("div");
  tile.className="tile tile-"+value;
  if(isNew) tile.classList.add("new");
  tile.textContent=value;
  setPosition(tile,r,c);
  tilesLayer.appendChild(tile);
}

function setPosition(tile,r,c){
  const x=c*(cell+gap)+offset;
  const y=r*(cell+gap)+offset;
  tile.style.transform=`translate(${x}px,${y}px)`;
}

function slide(row){
  row=row.filter(v=>v);
  for(let i=0;i<row.length-1;i++){
    if(row[i]===row[i+1]){
      row[i]*=2;
      score+=row[i];
      row[i+1]=0;
    }
  }
  row=row.filter(v=>v);
  while(row.length<size) row.push(0);
  return row;
}

function move(dir){
  let newBoard=board.map(r=>[...r]);

  for(let i=0;i<size;i++){
    if(dir==="left") newBoard[i]=slide(newBoard[i]);
    if(dir==="right") newBoard[i]=slide(newBoard[i].reverse()).reverse();
    if(dir==="up"){
      let col=slide(newBoard.map(r=>r[i]));
      for(let j=0;j<size;j++) newBoard[j][i]=col[j];
    }
    if(dir==="down"){
      let col=slide(newBoard.map(r=>r[i]).reverse()).reverse();
      for(let j=0;j<size;j++) newBoard[j][i]=col[j];
    }
  }

  if(JSON.stringify(newBoard)!==JSON.stringify(board)){
    board=newBoard;
    render();
    addRandom();
    scoreEl.textContent=score;
    updateBest();
  }
}

function render(){
  tilesLayer.innerHTML="";
  for(let r=0;r<size;r++)
    for(let c=0;c<size;c++)
      if(board[r][c])
        createTile(r,c,board[r][c]);
}

function updateBest(){
  let best=localStorage.getItem("best2048")||0;
  if(score>best){
    best=score;
    localStorage.setItem("best2048",best);
  }
  bestEl.textContent=best;
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") move("left");
  if(e.key==="ArrowRight") move("right");
  if(e.key==="ArrowUp") move("up");
  if(e.key==="ArrowDown") move("down");
});

bestEl.textContent=localStorage.getItem("best2048")||0;
init();
</script>

</body>
</html>